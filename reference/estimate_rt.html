<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Rt using smoothness-penalized Poisson likelihood — estimate_rt • rtestim</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Rt using smoothness-penalized Poisson likelihood — estimate_rt"><meta name="description" content="The Effective Reproduction Number \(R_t\) of an infectious
disease can be estimated by solving the smoothness penalized Poisson
regression (trend filtering) of the form:
$$\hat{\theta} = \arg\min_{\theta} \frac{1}{n} \sum_{i=1}^n (w_i e^{\theta_i} -
  y_i\theta_i) + \lambda\Vert D^{(k+1)}\theta\Vert_1, $$
where \(R_t = e^{\theta}\), \(y_i\) is the observed case count at day
\(i\), \(w_i\) is the weighted past counts at day \(i\), \(\lambda\)
is the smoothness penalty, and \(D^{(k+1)}\) is the \((k+1)\)-th order
difference matrix."><meta property="og:description" content="The Effective Reproduction Number \(R_t\) of an infectious
disease can be estimated by solving the smoothness penalized Poisson
regression (trend filtering) of the form:
$$\hat{\theta} = \arg\min_{\theta} \frac{1}{n} \sum_{i=1}^n (w_i e^{\theta_i} -
  y_i\theta_i) + \lambda\Vert D^{(k+1)}\theta\Vert_1, $$
where \(R_t = e^{\theta}\), \(y_i\) is the observed case count at day
\(i\), \(w_i\) is the weighted past counts at day \(i\), \(\lambda\)
is the smoothness penalty, and \(D^{(k+1)}\) is the \((k+1)\)-th order
difference matrix."><meta property="og:image" content="https://dajmcdon.github.io/rtestim/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtestim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/rtestim.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/delay-distributions.html">Delay distributions</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dajmcdon/rtestim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate Rt using smoothness-penalized Poisson likelihood</h1>
      <small class="dont-index">Source: <a href="https://github.com/dajmcdon/rtestim/blob/main/R/estimate_rt.R" class="external-link"><code>R/estimate_rt.R</code></a></small>
      <div class="d-none name"><code>estimate_rt.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The Effective Reproduction Number \(R_t\) of an infectious
disease can be estimated by solving the smoothness penalized Poisson
regression (trend filtering) of the form:</p>
<p>$$\hat{\theta} = \arg\min_{\theta} \frac{1}{n} \sum_{i=1}^n (w_i e^{\theta_i} -
  y_i\theta_i) + \lambda\Vert D^{(k+1)}\theta\Vert_1, $$</p>
<p>where \(R_t = e^{\theta}\), \(y_i\) is the observed case count at day
\(i\), \(w_i\) is the weighted past counts at day \(i\), \(\lambda\)
is the smoothness penalty, and \(D^{(k+1)}\) is the \((k+1)\)-th order
difference matrix.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimate_rt</span><span class="op">(</span></span>
<span>  <span class="va">observed_counts</span>,</span>
<span>  korder <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  dist_gamma <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">2.5</span><span class="op">)</span>,</span>
<span>  x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n</span>,</span>
<span>  lambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  nsol <span class="op">=</span> <span class="fl">50L</span>,</span>
<span>  delay_distn <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  delay_distn_periodicity <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambdamin <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambdamax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lambda_min_ratio <span class="op">=</span> <span class="fl">1e-04</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  init <span class="op">=</span> <span class="fu"><a href="configure_rt_admm.html">configure_rt_admm</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-observed-counts">observed_counts<a class="anchor" aria-label="anchor" href="#arg-observed-counts"></a></dt>
<dd><p>vector of the observed daily infection counts</p></dd>


<dt id="arg-korder">korder<a class="anchor" aria-label="anchor" href="#arg-korder"></a></dt>
<dd><p>Integer. Degree of the piecewise polynomial curve to be
estimated. For example, <code>korder = 0</code> corresponds to a piecewise constant
curve.</p></dd>


<dt id="arg-dist-gamma">dist_gamma<a class="anchor" aria-label="anchor" href="#arg-dist-gamma"></a></dt>
<dd><p>Vector of length 2. These are the shape and scale for the
assumed serial interval distribution. Roughly, this distribution describes
the probability of an infectious individual infecting someone else after
some period of time after having become infectious.
As in most literature, we assume that this interval follows a gamma
distribution with some shape and scale.</p></dd>


<dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>a vector of positions at which the counts have been observed. In an
ideal case, we would observe data at regular intervals (e.g. daily or
weekly) but this may not always be the case. May be numeric or Date.</p></dd>


<dt id="arg-lambda">lambda<a class="anchor" aria-label="anchor" href="#arg-lambda"></a></dt>
<dd><p>Vector. A user supplied sequence of tuning parameters which
determines the balance between data fidelity and
smoothness of the estimated Rt; larger <code>lambda</code> results in a smoother
estimate. The default, <code>NULL</code>
results in an automatic computation based on <code>nlambda</code>, the largest value
of <code>lambda</code> that would result in a maximally smooth estimate, and <code>lambda_min_ratio</code>.
Supplying a value of <code>lambda</code> overrides
this behaviour. It is likely better to supply a
decreasing sequence of <code>lambda</code> values than a single (small) value. If
supplied, the user-defined <code>lambda</code> sequence is automatically sorted in
decreasing order.</p></dd>


<dt id="arg-nsol">nsol<a class="anchor" aria-label="anchor" href="#arg-nsol"></a></dt>
<dd><p>Integer. The number of tuning parameters <code>lambda</code> at which to
compute Rt.</p></dd>


<dt id="arg-delay-distn">delay_distn<a class="anchor" aria-label="anchor" href="#arg-delay-distn"></a></dt>
<dd><p>in the case of a non-gamma delay distribution,
a vector or matrix (or <code><a href="https://rdrr.io/pkg/Matrix/man/Matrix.html" class="external-link">Matrix::Matrix()</a></code>) of delay probabilities may be
passed here. For a vector, these will be coerced
to sum to 1, and padded with 0 in the right tail if necessary. If a
time-varying delay matrix, it must be lower-triangular. Each row will be
silently coerced to sum to 1. See also <code><a href="../articles/delay-distributions.html">vignette("delay-distributions")</a></code>.</p></dd>


<dt id="arg-delay-distn-periodicity">delay_distn_periodicity<a class="anchor" aria-label="anchor" href="#arg-delay-distn-periodicity"></a></dt>
<dd><p>Controls the relationship between the spacing
of the computed delay distribution and the spacing of <code>x</code>. In the default
case, <code>x</code> would be regular on the sequence <code>1:length(observed_cases)</code>,
and this would
be 1. But if <code>x</code> is a <code>Date</code> object or spaced irregularly, the relationship
becomes more complicated. For example, weekly data when <code>x</code> is a date in
the form <code>YYYY-MM-DD</code> requires specifying <code>delay_distn_periodicity = "1 week"</code>.
Or if <code>observed_cases</code> were reported on Monday, Wednesday, and Friday,
then <code>delay_distn_periodicity = "1 day"</code> would be most appropriate.</p></dd>


<dt id="arg-lambdamin">lambdamin<a class="anchor" aria-label="anchor" href="#arg-lambdamin"></a></dt>
<dd><p>Optional value for the smallest <code>lambda</code> to use. This should
be greater than zero.</p></dd>


<dt id="arg-lambdamax">lambdamax<a class="anchor" aria-label="anchor" href="#arg-lambdamax"></a></dt>
<dd><p>Optional value for the largest <code>lambda</code> to use.</p></dd>


<dt id="arg-lambda-min-ratio">lambda_min_ratio<a class="anchor" aria-label="anchor" href="#arg-lambda-min-ratio"></a></dt>
<dd><p>If neither <code>lambda</code> nor <code>lambdamin</code> is specified, the
program will generate a lambdamin by lambdamax * lambda_min_ratio.
A multiplicative factor for the minimal lambda in the
<code>lambda</code> sequence, where <code>lambdamin = lambda_min_ratio * lambdamax</code>.
A very small value will lead to the solution <code>Rt = log(observed_counts)</code>.
This argument has no effect if there is a user-defined <code>lambda</code> sequence.</p></dd>


<dt id="arg-maxiter">maxiter<a class="anchor" aria-label="anchor" href="#arg-maxiter"></a></dt>
<dd><p>Integer. Maximum number of iterations for the estimation
algorithm.</p></dd>


<dt id="arg-init">init<a class="anchor" aria-label="anchor" href="#arg-init"></a></dt>
<dd><p>a list of internal configuration parameters of class
<code>rt_admm_configuration</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An object with S3 class <code>poisson_rt</code>. Among the list components:</p><ul><li><p><code>observed_counts</code> the observed daily infection counts.</p></li>
<li><p><code>x</code> a vector of positions at which the counts have been observed.</p></li>
<li><p><code>weighted_past_counts</code> the weighted sum of past infection counts.</p></li>
<li><p><code>Rt</code> the estimated effective reproduction rate. This is a matrix with
each column corresponding to one value of <code>lambda</code>.</p></li>
<li><p><code>lambda</code> the values of <code>lambda</code> actually used in the algorithm.</p></li>
<li><p><code>korder</code> degree of the estimated piecewise polynomial curve.</p></li>
<li><p><code>dof</code> degrees of freedom of the estimated trend filtering problem.</p></li>
<li><p><code>niter</code> the required number of iterations for each value of <code>lambda</code>.</p></li>
<li><p><code>convergence</code> if number of iterations for each value of <code>lambda</code> is less
than the maximum number of iterations for the estimation algorithm.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">15</span><span class="op">)</span> <span class="op">*</span> <span class="fl">500</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">estimate_rt</span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_rt-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">out0</span> <span class="op">&lt;-</span> <span class="fu">estimate_rt</span><span class="op">(</span><span class="va">y</span>, korder <span class="op">=</span> <span class="fl">0L</span>, nsol <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">out0</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="estimate_rt-2.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel J. McDonald, Jiaping Liu, Zhenglun Cai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

