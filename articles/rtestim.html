<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>rtestim Package Vignette • rtestim</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="rtestim Package Vignette">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rtestim</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.5</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/rtestim.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/delay-distributions.html">Delay distributions</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/dajmcdon/rtestim/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>rtestim Package Vignette</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/dajmcdon/rtestim/blob/main/vignettes/rtestim.Rmd" class="external-link"><code>vignettes/rtestim.Rmd</code></a></small>
      <div class="d-none name"><code>rtestim.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This package uses Poisson likelihood with trend filtering penalty (a
type of regularized nonparametric regression) to estimate the effective
reproductive number,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.
This value roughly says “how many new infections will result from each
new infection today”. Values larger than 1 indicate that an epidemic is
growing while those less than 1 indicate decline.</p>
<p>This vignette provides a few examples to demonstrate the usage of
<a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a> to estimate the effective reproduction number,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.
<a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a> finds a sequence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>
of an infectious disease by solving the following penalized Poisson
regression
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mo>=</mo><msub><mo>argmin</mo><mi>θ</mi></msub><mfrac><mn>1</mn><mi>n</mi></mfrac><munderover><mo>∑</mo><mrow><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>e</mi><msub><mi>θ</mi><mi>t</mi></msub></msup><msub><mi>x</mi><mi>t</mi></msub><mo>−</mo><msub><mi>y</mi><mi>t</mi></msub><msub><mi>θ</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mi>λ</mi><mo stretchy="false" form="postfix">‖</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mi>θ</mi><msub><mo stretchy="false" form="postfix">‖</mo><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\begin{equation} \label{eq:objective_fn}
    \hat{\theta} = \mathop{\mathrm{argmin}}_{\theta} \frac{1}{n} \sum_{t=1}^n \left(e^{\theta_{t}}x_t - y_t\theta_{t}\right) + \lambda \Vert D^{(k+1)} \theta \Vert_1
\end{equation}</annotation></semantics></math> where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>
is the an epidemic signal, ideally, incident infections, but most
frequently, incident cases, on day
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>t</mi></msub><mo>=</mo><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>R</mi><mi>t</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_{t} = \log(R_t)</annotation></semantics></math>
is the natural logarithm of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>
at time
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">D^{(k)}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-th
order divided difference operator
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≥</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k \geq 0</annotation></semantics></math>).
The penalty
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="postfix">‖</mo><msup><mi>D</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></msup><mi>θ</mi><msub><mo stretchy="false" form="postfix">‖</mo><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">\Vert D^{(k+1)} \theta \Vert_1</annotation></semantics></math>
imposes smoothness on the solution and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
controls the level of this smoothness, with larger
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
resulting in smoother estimates.</p>
<p>In particular
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>t</mi></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>a</mi><mo>=</mo><mn>1</mn></mrow><mi>m</mi></munderover><msub><mi>y</mi><mrow><mi>t</mi><mo>−</mo><mi>a</mi></mrow></msub><msub><mi>w</mi><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\begin{equation}
x_t = \sum_{a = 1}^m y_{t-a} w_a
\end{equation}</annotation></semantics></math> is the weighted sum of
previous incidence at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
calculated by convolving the preceding
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
days of new infections with the discretized serial interval distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>w</mi><annotation encoding="application/x-tex">w</annotation></semantics></math>
of length
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>.
This delay distribution encapsulates the duration of time that a
previous infection is likely to lead to future infection.</p>
<p>To compute
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>
with <a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a>, the minimal information needed is the new
case counts at days up until
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
and a parametric form for the serial interval distribution (a Gamma
density). By default,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>2.5</mn><annotation encoding="application/x-tex">2.5</annotation></semantics></math>
is used for both the scale and shape parameters, based on the literature
on contract tracing, representing the typical delay between case onsets.
This is discretized to be supported on the integers. The order of the
difference operator, the degree of smoothness, defaults to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>3</mn><annotation encoding="application/x-tex">3</annotation></semantics></math>.
The sequence of smoothness penalty
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>,
if no
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
is provided, is calculated internally by the algorithm.</p>
</div>
<div class="section level2">
<h2 id="example---synthetic-dataset">Example - synthetic dataset<a class="anchor" aria-label="anchor" href="#example---synthetic-dataset"></a>
</h2>
<div class="section level3">
<h3 id="quick-start">Quick start<a class="anchor" aria-label="anchor" href="#quick-start"></a>
</h3>
<p>We first demonstrate the usage of the package on synthetic data,
where the new daily case counts are generated from a Poisson
distribution with mean parameter that roughly follows a wave. Note that
the first observation must be strictly larger than 0.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234</span><span class="op">)</span></span>
<span><span class="va">case_counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>, <span class="fl">50</span>, <span class="fl">15</span><span class="op">)</span> <span class="op">*</span> <span class="fl">500</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">101</span>, <span class="va">case_counts</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">case_counts</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>colour <span class="op">=</span> <span class="st">"cornflowerblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Case Counts"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-2-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>Next, we fit the model and visualize the resulting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_rt.html">estimate_rt</a></span><span class="op">(</span>observed_counts <span class="op">=</span> <span class="va">case_counts</span>, nsol <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-3-1.png" width="80%" style="display: block; margin: auto;"></p>
<p><a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a> estimates a spectrum of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>s
for a range of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
values, where each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>
corresponds to a specific
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
value. If no
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
value is supplied by the user, <a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a> will automatically
calculate a sequence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
values. The additional parameter <code>nsol = 20</code> specifies the
number of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>s
for which the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>
is calculated</p>
</div>
<div class="section level3">
<h3 id="cross-validation">Cross Validation<a class="anchor" aria-label="anchor" href="#cross-validation"></a>
</h3>
<p><a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a> also provides a cross validation procedure for
selecting the amount of smoothness to be used in the final estimate
(leave-every-k-th-out cross validation). Minimizing this metric, in
principle, balances prediction error and smoothness
(<code>lambda.min</code>) though if smoother estimates are desired, one
can instead use <code>lambda.1se</code>, the largest value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
within one standard error of the minimum.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod_cv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/cv_estimate_rt.html">cv_estimate_rt</a></span><span class="op">(</span>observed_counts <span class="op">=</span> <span class="va">case_counts</span><span class="op">)</span></span></code></pre></div>
<p>The following command plots the cross validation errors for each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
in ascending order.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_cv</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-5-1.png" width="80%" style="display: block; margin: auto;"></p>
<p>The plot above displays vertical lines that correspond to the
cross-validation scores for specific values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>.
The blue point at the center of each line represents the mean score for
that value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
across all cross-validation folds. The top and bottom caps of each line
indicate one cross-validation standard error above and below the mean
score for the given value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
across all cross-validation folds. Two special values of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>’s
are highlighted with dashed lines. The one on the left represents the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
that gives minimum mean cross-validated error, called
<code>lambda.min</code>, and the one on the right gives the most
regularized model such that the cross-validated error is within one
standard error of the minimum, called <code>lambda.1se</code>.</p>
<p>Users may wish to visualize the particular
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>
which minimizes the cross-validation error while prioritizing
smoothness.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod_cv</span>, which_lambda <span class="op">=</span> <span class="st">"lambda.1se"</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-6-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="uneven-reporting-frequency">Uneven Reporting Frequency<a class="anchor" aria-label="anchor" href="#uneven-reporting-frequency"></a>
</h3>
<p>Ideally, case counts are observed at regular intervals, such as daily
or weekly, but this is not always the case. <a href="https://github.com/dajmcdon/rtestim" class="external-link">rtestim</a> also
accommodates scenarios in which cases are reported with uneven
intervals. To demonstrate this, we generate a sequence of integers
representing the days at which we observe the case counts.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">observation_incr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">101</span>, lambda <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">observation_incr</span><span class="op">[</span><span class="va">observation_incr</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span><span class="va">observation_time</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cumsum.html" class="external-link">cumsum</a></span><span class="op">(</span><span class="va">observation_incr</span><span class="op">)</span></span></code></pre></div>
<p>We can then fit the model by passing the observation time point as
<code>x</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_rt.html">estimate_rt</a></span><span class="op">(</span>observed_counts <span class="op">=</span> <span class="va">case_counts</span>, x <span class="op">=</span> <span class="va">observation_time</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-8-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="changing-degree-of-difference-operator">Changing degree of difference operator<a class="anchor" aria-label="anchor" href="#changing-degree-of-difference-operator"></a>
</h3>
<p>The degree of the estimated penalized Poisson regression function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
defaults to 3 for the algorithm, which corresponds to a piece-wise cubic
estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>.
To estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>{</mo><annotation encoding="application/x-tex">\mathop{\{R_t\}_{t=1}^n}</annotation></semantics></math>
with piece-wise constant curves for example, use the command</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_rt.html">estimate_rt</a></span><span class="op">(</span>observed_counts <span class="op">=</span> <span class="va">case_counts</span>, korder <span class="op">=</span> <span class="fl">0</span>, nsol <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mod</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-9-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="example---canadian-covid-19-cases">Example - Canadian Covid-19 cases<a class="anchor" aria-label="anchor" href="#example---canadian-covid-19-cases"></a>
</h2>
<p>Finally, we use a long history of real case counts in Canada. The
data is available from <a href="https://opencovid.ca" class="external-link">opencovid.ca</a>
and the version downloaded on 4 July 2023 is included in the package. We
use this data to estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>R</mi><mi>t</mi></msub><annotation encoding="application/x-tex">R_t</annotation></semantics></math>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">can</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_rt.html">estimate_rt</a></span><span class="op">(</span></span>
<span>  observed_counts <span class="op">=</span> <span class="va">cancovid</span><span class="op">$</span><span class="va">incident_cases</span>,</span>
<span>  x <span class="op">=</span> <span class="va">cancovid</span><span class="op">$</span><span class="va">date</span>,</span>
<span>  korder <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  nsol <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  maxiter <span class="op">=</span> <span class="fl">1e5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">can</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-10-1.png" width="80%" style="display: block; margin: auto;"></p>
<div class="section level3">
<h3 id="approximate-confidence-bands">Approximate confidence bands<a class="anchor" aria-label="anchor" href="#approximate-confidence-bands"></a>
</h3>
<p>We also provide functionality for computing approximate confidence
bands for Rt based on normal approximations and the delta method. These
are intended to be fast and to provide some idea of uncertainty, but
they likely don’t have guaranteed coverage.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">can_cb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/confband.html">confband</a></span><span class="op">(</span><span class="va">can</span>, lambda <span class="op">=</span> <span class="va">can</span><span class="op">$</span><span class="va">lambda</span><span class="op">[</span><span class="fl">10</span><span class="op">]</span>, level <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.8</span>, <span class="fl">.95</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">can_cb</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; An `rt_confidence_band` object.</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; * type = Rt </span></span>
<span><span class="co">#&gt; * lambda = 8976.305 </span></span>
<span><span class="co">#&gt; * degrees of freedom = 12 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,253 × 7</span></span></span>
<span><span class="co">#&gt;      fit  `2.5%` `10.0%` `25.0%` `75.0%` `90.0%` `97.5%`</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  2.05 <span style="color: #BB0000;">NaN</span>      <span style="color: #BB0000;">NaN</span>     <span style="color: #BB0000;">NaN</span>     <span style="color: #BB0000;">NaN</span>     <span style="color: #BB0000;">NaN</span>     <span style="color: #BB0000;">NaN</span>   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  2.03   1.95     1.97    2.00    2.05    2.08    2.10</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  2.01   1.85     1.91    1.95    2.06    2.11    2.16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  1.99   1.74     1.83    1.90    2.07    2.15    2.23</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  1.97   1.60     1.73    1.84    2.09    2.21    2.33</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  1.95   1.44     1.62    1.77    2.12    2.28    2.45</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  1.93   1.27     1.50    1.70    2.16    2.36    2.59</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  1.91   1.09     1.38    1.63    2.19    2.45    2.73</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  1.89   0.918    1.26    1.56    2.23    2.53    2.87</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  1.88   0.756    1.14    1.49    2.26    2.61    3.00</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 1,243 more rows</span></span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">can_cb</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span>ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="rtestim_files/figure-html/unnamed-chunk-11-1.png" width="80%" style="display: block; margin: auto;"></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Daniel J. McDonald, Jiaping Liu, Zhenglun Cai.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
